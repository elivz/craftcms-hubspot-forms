{% if (form is defined and form is not empty) and (portalId is defined and portalId is not empty) %}

    <script>

        /*
         * Load HubSpot script
         */
        function loadHubspotScript( callback )
        {
            
            /* If the script is already loaded or in the process of loading, exit the function */
            if (window.hubspotScriptLoaded) return callback();

            /* Create script element */
            let script = document.createElement('script');
            script.type = 'text/javascript';

            /* Once loaded, call callbck function */
            /* Internet Explorer */
            if( script.readyState )
            {
                script.onreadystatechange = function() {
                    if (script.readyState === "loaded" || script.readyState === "complete") {
                        script.onreadystatechange = null;
                        callback();
                    }
                };
            } 
            /* Other browsers */
            else 
            {
                script.onload = callback;
            }

            /* Set script source */
            script.src = 'https://js.hsforms.net/forms/v2.js';

            /* Append script element to head */
            document.getElementsByTagName('head')[0].appendChild(script);

            /* Set script loaded variable to true */
            window.hubspotScriptLoaded = true;

        }

        /*
         * Create HubSpot form
         */
        function createHubspotForm() {
            if( document.querySelector('.hbspt-form') === null )
            {
                hbspt.forms.create({
                    portalId: "{{ portalId }}",
                    formId: "{{ form }}"
                });
            }
        }

        /*
         * Call loadHubspotScript
         */
        loadHubspotScript(function() {
            /* On scroll, call createHubspotForm */
            window.addEventListener('scroll', createHubspotForm);
        });
        
    </script>

{% else %}

    {# Report error #}
    <script>
        console.log("[HubSpot Forms] Could not render form.")
    </script>
    
{% endif %}